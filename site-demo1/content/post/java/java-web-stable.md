+++
title = "浅谈JavaWeb高并发业务处理"
date = "2019-08-25"
tags = ["高并发"]
categories = ["Java","JavaWeb"]
+++
# 浅谈JavaWeb中高并发业务处理
在JavaWeb应用中高并发的业务场景是非常常见的，例如电商、抽奖、热搜等等，都有涉及到高并发场景的处理，一方面要保证业务稳定，不会因为高并发情况导致所有服务宕机，另一方面保证业务数据安全，不会因为高并发情况下数据出现问题，导致业务提供者遭受重大损失，用户出现损失等。保证业务正常运营的情况下用户亦拥有良好的体验。另外高并发业务处理在面试是也是比较常见的问题，很多面试官或者公司都会要求求职者有高并发处理的相关经验，本文将简单介绍高并发业务常见的处理方式和相关知识。

## 一、业务分析
对高并发的处理不能盲目的加服务器、加缓存、限流，首先要做的是对并发场景进行分析，对最高并发量进行一个大概的估算，确定一个最终的技术方向和服务器容量，日并发估算的公式很多，这里举一个例子：

### (1)平均并发用户数为 C = nl/T
```
1、用户从登陆系统到退出系统的间隔时间L
2、登陆系统的用户数量n
3、被考察的时间长度T
```

### (2)并发用户数峰值 `C = C + 3*sqr(C)`

举例： 如果系统有3000个注册用户，平均每天400个用户要访问系统，一般一个典型用户在系统中停留4小时（从登陆到退出），在一天内，用户在8小时内使用该系统 并发用户数=400X4/8=200 如果你要计算峰值用户数的话，用另外一个公式 C1=C+3 X sqr© C表示并发用户数 根据之前算出的结果，并发用户数是200，那么公式为： C1=200+3 x sqr(200)=242

一般来说tomcat并发200完美胜任，达到500左右就力不从心了，这个时候就要考虑分布式架构，通过多台服务器负载均衡，提交并发量

## 二、系统架构
一般来说分布式的系统结构图如下所示，虽然比较简略，但已经能够表明意思
![分布式系统架构图](/static/images/img/分布式系统架构图.png)
在此基础上，单体服务器架构图如下所示：
![系统架构图](/static/images/img/系统架构图.png)

## 三、各层简介
### 3.1应用层
1. 浏览器缓存、本地缓存（app）：减少了冗余的数据传输、提升用户体验，减少服务器负担

2. 按钮控制、图形验证码：减少单位时间内用户请求的次数

### 3.2网络层
- CDN
### 3.3负载层
- 负载均衡
- 动静分离
- 方向代理缓存
- 限流
### 3.4服务层
- 动态页面静态化：将动态页面静态化有利于提高页面响应速度，还可以降低服务器压力
- 应用缓存->分布式缓存：使用缓存，提高资源读取能力，不用每次请求都从数据库获取数据
- 异步、队列：使用异步请求，保证服务不会因为未处理完请求而不响应
- 限流：限制单位时间内请求的数量，增强在高并发场景下服务的稳定性（这里一般的限流算法有：计数法，漏水法，令牌桶法）
- 原子操作保障->事务
### 3.5数据层
- 乐观锁
- 悲观锁
使用乐观锁或悲观锁保障数据安全性，在数据经常被修改时使用悲观锁，在数据更新不频繁时使用乐观锁

## 四、参考文章
[JAVA构建高并发商城秒杀系统——架构分析](https://www.cnblogs.com/cxydczzl/p/9668061.html)

[谈谈限流算法的几种实现](https://www.jqhtml.com/28773.html)